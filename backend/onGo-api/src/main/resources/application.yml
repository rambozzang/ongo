server:
  port: 8070
  servlet:
    context-path: /

spring:
  application:
    name: ongo-api
  threads:
    virtual:
      enabled: true

  # DataSource
  datasource:
    url: jdbc:postgresql://localhost:54332/ongo?stringtype=unspecified
    username: ${DB_USERNAME:ongo}
    password: ${DB_PASSWORD:aaaAAA111!!!}
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 20
      minimum-idle: 5
      idle-timeout: 30000
      max-lifetime: 1800000

  # jOOQ
  jooq:
    sql-dialect: POSTGRES

  # Flyway
  flyway:
    enabled: true
    locations: classpath:db/migration

  # Cache - configured in CaffeineCacheConfig.kt

  # Spring AI - Anthropic (primary)
  ai:
    anthropic:
      api-key: ${ANTHROPIC_API_KEY:dummy-anthropic-key}
      chat:
        options:
          model: claude-sonnet-4-5-20250514
          max-tokens: 4096
          temperature: 0.7
    openai:
      api-key: ${OPENAI_API_KEY:dummy-openai-key}
    vertex:
      ai:
        gemini:
          enabled: ${GEMINI_ENABLED:false}
          project-id: ${GEMINI_PROJECT_ID:}
          location: ${GEMINI_LOCATION:us-central1}
          chat:
            options:
              model: gemini-2.5-pro
              temperature: 0.7

  # Security
  security:
    oauth2:
      client:
        registration:
          google:
            client-id: ${GOOGLE_CLIENT_ID:your-client-id}
            client-secret: ${GOOGLE_CLIENT_SECRET:your-client-secret}
            scope: openid,profile,email
          kakao:
            client-id: ${KAKAO_CLIENT_ID:your-client-id}
            client-secret: ${KAKAO_CLIENT_SECRET:your-client-secret}
            authorization-grant-type: authorization_code
            redirect-uri: "{baseUrl}/api/v1/auth/callback/kakao"
            scope: profile_nickname,account_email
        provider:
          kakao:
            authorization-uri: https://kauth.kakao.com/oauth/authorize
            token-uri: https://kauth.kakao.com/oauth/token
            user-info-uri: https://kapi.kakao.com/v2/user/me
            user-name-attribute: id

  # Servlet multipart
  servlet:
    multipart:
      max-file-size: 5GB
      max-request-size: 5GB

# JWT
jwt:
  secret: ${JWT_SECRET}
  access-token-expiry: 1800000   # 30 minutes
  refresh-token-expiry: 604800000 # 7 days

# MinIO / S3 / R2 Storage
storage:
  type: minio
  bucket: ongo-videos
  minio:
    endpoint: http://localhost:9000
    access-key: ${MINIO_ACCESS_KEY:minioadmin}
    secret-key: ${MINIO_SECRET_KEY:minioadmin}
  s3:
    region: ap-northeast-2
    endpoint: ${S3_ENDPOINT:}
    access-key: ${S3_ACCESS_KEY:}
    secret-key: ${S3_SECRET_KEY:}

# Payment (Toss)
payment:
  toss:
    webhook-secret: ${TOSS_WEBHOOK_SECRET:}

# Platform encryption & OAuth
platform:
  token:
    encryption-key: ${PLATFORM_TOKEN_ENCRYPTION_KEY:change-me-to-a-secure-secret-key-for-platform-tokens-32-bytes}
  google:
    api-key: ${GOOGLE_API_KEY:}
  twitter:
    client-id: ${TWITTER_CLIENT_ID:}
    client-secret: ${TWITTER_CLIENT_SECRET:}
  facebook:
    app-id: ${FACEBOOK_APP_ID:}
    app-secret: ${FACEBOOK_APP_SECRET:}
  threads:
    app-id: ${THREADS_APP_ID:}
    app-secret: ${THREADS_APP_SECRET:}
  pinterest:
    app-id: ${PINTEREST_APP_ID:}
    app-secret: ${PINTEREST_APP_SECRET:}
  linkedin:
    client-id: ${LINKEDIN_CLIENT_ID:}
    client-secret: ${LINKEDIN_CLIENT_SECRET:}
  wordpress:
    client-id: ${WORDPRESS_CLIENT_ID:}
    client-secret: ${WORDPRESS_CLIENT_SECRET:}
  tumblr:
    consumer-key: ${TUMBLR_CONSUMER_KEY:}
    consumer-secret: ${TUMBLR_CONSUMER_SECRET:}
  vimeo:
    client-id: ${VIMEO_CLIENT_ID:}
    client-secret: ${VIMEO_CLIENT_SECRET:}
  dailymotion:
    api-key: ${DAILYMOTION_API_KEY:}
    api-secret: ${DAILYMOTION_API_SECRET:}

# CORS
cors:
  allowed-origins: ${CORS_ALLOWED_ORIGINS:http://localhost:3000,http://localhost:3001,http://localhost:5173,https://ongo.codelabtiger.com}

# Springdoc / Swagger
springdoc:
  api-docs:
    path: /api-docs
  swagger-ui:
    path: /swagger-ui.html
    tags-sorter: alpha
    operations-sorter: alpha
  default-consumes-media-type: application/json
  default-produces-media-type: application/json

# Resilience4j — 플랫폼 API 호출 안정성
resilience4j:
  retry:
    instances:
      platformApi:
        max-attempts: 3
        wait-duration: 2s
        exponential-backoff-multiplier: 2
        retry-exceptions:
          - java.io.IOException
          - java.net.SocketTimeoutException
          - org.springframework.web.client.ResourceAccessException
        ignore-exceptions:
          - com.ongo.common.exception.PlatformUploadException
  circuitbreaker:
    instances:
      platformApi:
        sliding-window-size: 10
        failure-rate-threshold: 50
        wait-duration-in-open-state: 60s
        permitted-number-of-calls-in-half-open-state: 3
        slow-call-duration-threshold: 30s
        slow-call-rate-threshold: 80

# Logging (production defaults - use application-dev.yml for DEBUG)
logging:
  level:
    root: INFO
    com.ongo: INFO
    org.jooq: WARN
    org.springframework.ai: INFO
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"
  file:
    name: logs/ongo-api.log

# Actuator
management:
  endpoints:
    web:
      exposure:
        include: health,info
  endpoint:
    health:
      show-details: when-authorized
